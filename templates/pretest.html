{% extends 'base.html' %}

{% load static %}

{% block title %}Pre-Test - Huffman Coding{% endblock %}

{% block extra_css %}
<link rel="stylesheet" type="text/css" href="{% static 'css/quiz.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'css/pretest.css' %}">
{% endblock %}

{% block page_title %}Pre-Test: Understanding Huffman Coding{% endblock %}

{% block content %}
<div class="pretest-row">
    <div class="col-12 pretest-container">
        <div class="card mb-4">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0"><i class="fas fa-info-circle me-2"></i>Instructions</h5>
            </div>
            <div class="card-body">
                <p>Fill in the correct values in the table fields based on the Huffman coding procedure.</p>
                <p>When you have entered all values, click "Check Answers" to verify your solution.</p>
                <p>After submitting correct answers, you will be able to proceed to the Simulation section.</p>
                
                <button type="button" class="btn btn-info mt-3" data-bs-toggle="modal" data-bs-target="#procedureModal">
                    <i class="fas fa-list-ol me-2"></i>View Huffman Coding Procedure
                </button>
            </div>
        </div>
        
        <div class="card shadow mb-4">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Huffman Coding Table Exercise</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">Probability</th>
                                <th scope="col">Step 1</th>
                                <th scope="col">Step 2</th>
                                <th scope="col">Step 3</th>
                                <th scope="col">Huffman code</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row" class="text-center">0.4</th>
                                <td class="text-center">0.4</td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row1col3" placeholder="Value">
                                </td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row1col4" placeholder="Value">
                                </td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row1col5" placeholder="Code">
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="text-center">0.2</th>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row2col2" placeholder="Value">
                                </td>
                                <td class="text-center">0.4</td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row2col4" placeholder="Value">
                                </td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row2col5" placeholder="Code">
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="text-center">0.2</th>
                                <td class="text-center">0.2</td>
                                <td class="text-center">0.2</td>
                                <td class="text-center">----</td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row3col5" placeholder="Code">
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="text-center">0.1</th>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row4col2" placeholder="Value">
                                </td>
                                <td class="text-center">----</td>
                                <td class="text-center">----</td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row4col5" placeholder="Code">
                                </td>
                            </tr>
                            <tr>
                                <th scope="row" class="text-center">0.1</th>
                                <td class="text-center">----</td>
                                <td class="text-center">----</td>
                                <td class="text-center">----</td>
                                <td class="text-center">
                                    <input type="text" class="form-control text-center" id="row5col5" placeholder="Code">
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                
                <div class="text-center mt-4">
                    <button class="btn btn-primary px-4" id="checkAnswersBtn">
                        <i class="fas fa-check-circle me-2"></i>Check Answers
                    </button>
                </div>
                
                <div class="text-center mt-3">
                    <button class="btn btn-success px-4" id="toSimulation" onclick="location.href='{% url 'simulation' %}'" disabled>
                        <i class="fas fa-arrow-right me-2"></i>Proceed to Simulation
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="procedureModal" tabindex="-1" aria-labelledby="procedureModalTitle" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="procedureModalTitle">Huffman Coding Procedure</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="fas fa-list-ol me-2"></i>Step-by-Step Procedure</h5>
                        <ol class="list-group list-group-numbered">
                            <li class="list-group-item">List the given source of symbols in order of their specified decreasing probability.</li>
                            <li class="list-group-item">Assign a binary logic '0' and '1' to the two source symbols of lowest probability in the list obtained in above step.</li>
                            <li class="list-group-item">Add the probability of these two source symbols and regard it as one new source symbol. This results in a reduction of the size of the list of source symbols by 1.</li>
                            <li class="list-group-item">Place the assigned probability of the new symbol, high or low in the list with the rest of symbols, with their given probabilities.</li>
                            <li class="list-group-item">Repeat the procedure specified in steps from 2 to 4, till the final set of 2 source symbols is obtained.</li>
                            <li class="list-group-item">Assign binary logic 0 & 1 to the final two source symbols and all obtained symbols in step 5.</li>
                            <li class="list-group-item">Determine Codeword for each original source symbol by working backward and tracing the sequence of binary logic values.</li>
                        </ol>
                    </div>
                </div>
                <div class="alert alert-info">
                    <div class="d-flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-info-circle fa-2x me-3"></i>
                        </div>
                        <div>
                            <h5 class="alert-heading">Pre-Test Instructions</h5>
                            <p>Fill the correct values in the table fields and click "Check Answers" to verify your answers.</p>
                            <img src="{% static 'images/pro3.png' %}" alt="Pre-test example" class="img-fluid my-3 rounded shadow-sm">
                            <p>After submitting correct answers, the "Proceed to Simulation" button will be activated.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Remove the container and row style modifications that are causing the navbar issue
        // Only keep what's necessary for the pretest content area
        
        // Fix pretest container width
        document.querySelectorAll('.pretest-container').forEach(function(container) {
            container.style.width = '100%';
        });
        
        document.getElementById('checkAnswersBtn').addEventListener('click', checkAnswer);
    });

    function checkAnswer() {
        var a = document.getElementById("row2col2").value;
        var b = document.getElementById("row4col2").value;
        var c = document.getElementById("row1col3").value;
        var d = document.getElementById("row1col4").value;
        var e = document.getElementById("row2col4").value;
        var f = document.getElementById("row1col5").value;
        var g = document.getElementById("row2col5").value;
        var h = document.getElementById("row3col5").value;
        var i = document.getElementById("row4col5").value;
        var j = document.getElementById("row5col5").value;
        
        if (
            a == "0.2" &&
            b == "0.2" &&
            c == "0.4" &&
            d == "0.6" &&
            e == "0.4" &&
            f == "00" &&
            g == "10" &&
            h == "11" &&
            i == "010" &&
            j == "011"
        ) {
            Swal.fire({
                icon: 'success',
                title: 'Great Job!',
                text: 'All answers are correct. You can now proceed to the Simulation section.',
                confirmButtonColor: '#4361ee'
            });
            document.getElementById("toSimulation").disabled = false;
            // Save completion status
            localStorage.setItem('preTestCompleted', 'true');
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Incorrect',
                text: 'Please check your answers and try again.',
                confirmButtonColor: '#4361ee'
            });
        }
    }
</script>
{% endblock %}